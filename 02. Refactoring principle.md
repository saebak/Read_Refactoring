# 02. 리팩터링 원칙

## 리팩터링의 정의

1. 리팩터링[명사] : 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법<br/>(ex, 함수 추출하기, 조건부 로직 다형성으로 바꾸기)
2. 리팩터링[동사] : 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.


  사람이 코드를 정리하는 작업 ≠ 리팩터링<br/>
  특정한 방식에 따라 코드를 정리하는 것 == 리팩터링     
 
<em>
한 번에 바꿀 수 있는 작업을 수많은 단계로 잘게 나눠서 작업하는 모습을 처음 접하면 리팩터링하는 것이 비효율적이라 생각할 수 있지만 <br/>
잘게 나눔으로써 단계들이 체계적으로 구성되어 있고 디버깅하는데 시간을 뺏기지 않기 때문에 오히려 작업을 더 빨리 처리할 수 있다.
</em>

#### 리팩터링과 성능 최적화
공통점 : 코드를 변경하지만 프로그램의 전반적인 기능은 그대로 유지한다<br/>
차이점 : 
- 리팩터링은 코드를 이해하고 수정하기 쉽게 만드는 것으로 프로그램 성능이 좋아질 수도, 나빠질 수도 있다.
- 성능 최적화는 오로지 속도 개선에만 신경쓴다. 목표 성능에 반드시 도달해야 한다면 코드는 다루기에 더 어렵게 바뀔 수 있다.<br/>(서로 목표가 다름)
         
         
<br/>

## 두 개의 모자

소프트웨어를 개발할 때 목적이 '기능 추가'이냐 '리팩터링'이냐를 명확히 구분해 작업하는 것
켄트 벡이 이를 두 개의 모자에 비유했다.

<br/>

## 리팩터링하는 이유

1. 리팩터링하면 소프트웨어 설계가 좋아진다
   리팩터링하지 않으면 소프트웨어의 내부 설계(아키텍처)가 썩기 쉽다. 
   아키텍처를 충분히 이해 못한채 코드를 수정하다 보면 기반 구조가 무너지기 쉽다. -> 코드만 보고 설계를 파악하기 어렵다.
   (ex. 중복 코드 발생으로 수정이 어려워짐)
2. 리팩터링하면 소프트웨어를 이해하기 쉬워진다.
   기억할 필요가 있는 코드들의 목적이 잘 드러나게 리팩터링하여 이해를 돕는다.
3. 리팩터링하면 버그를 쉽게 찾을 수 있다.
   리팩터링하면 코드가 하는 일을 깊이 파악하게 되면서 버그들이 드러난다.
4. 리팩터링하면 프로그래밍 속도를 높일 수 있다.
   내부 설계와 가독성이 개선되고 버그가 줄어든다는 점은 모두 품질 향상에 직결된다.
<br/>   
   
## 언제 리팩터링해야 할까?

 3의 법칙
 1. 처음엔 그냥 한다.
 2. 비슷한 일을 두 번째로 하게 되면 일단 계속 진행한다.
 3. 비슷한 일을 세 번째 하게 되면 리팩터링한다.

 - <strong>준비를 위한 리팩터링 : 기능을 쉽게 추가하게 만들기<br/></strong>
   리팩터링하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전이다.<br/>
   (중복된 코드를 '함수 매개변수화하기'를 적용하여 한 곳으로 합친다)
 - <strong>이해를 위한 리팩터링 : 코드를 이해하기 쉽게 만들기<br/></strong>
   코드를 파악할 때마다 그 코드의 의도가 더 명확하게 드러나도록 리팩터링할 여지를 찾아본다.<br/>
   조건부 로직 구조, 함수 이름 등등
 - <strong>쓰레기 줍기 리팩터링<br/></strong>
   간단하게 수정할 수 있는 것은 즉시 수정하고, 시간이 좀 걸리는 일은 짧은 메모를 남긴 뒤 하던 일을 끝내고 나서 처리한다.<br/>
   리팩터링은 각각의 작은 단계가 코드를 깨드리지 않기 때문에 작업을 잘게 나누어 몇달에 걸쳐 진행해도 괜찮다.
 - <strong>계획된 리팩터링과 수시로 하는 리팩터링<br/></strong>
   계획된것보단 수시로 하는게 좋은데 그동안 리팩터링에 소홀했다면 계획하는것도 ㄱㅊ
 - <strong>오래 걸리는 리팩터링<br/></strong>
   라이브러리를 교체하는 작업 or 일부 코드를 다른 팀과 공유하기 위해 컴포넌트를 빼내는 작업 등과 같은 대규모 리팩터링
 - <strong>코드 리뷰에 리팩터링 활용하기<br/></strong>
   리팩터링은 코드리뷰의 결과를 더 구체적으로 도출하는데에 도움이된다. 개선안들을 제시하는 데서 그치지 않고 상당수를 즉시 구현해볼 수 있기 때문이다.<br/>
   코드 작성자와 함께 검토하며 리팩터링한다.
 - <strong>리팩터링하지 말아야 할 때<br/></strong>
   지저분한 코드를 발견해도 굳이 수정할 필요가 없다면 리팩터링하지 않는다<br/>
   (ex. 외부 API 다루듯 호출해서 쓰는코드)<br/>
   리팩터링하는 것보다 처음부터 새로 작성하는게 쉬울 때도 리팩터링하지 않는다.

<br/>

## 리팩터링 시 고려할 문제

 - <strong>새 기능 개발 속도 저하</strong> : 리팩터링의 궁극적인 목적은 개발 속도를 높여서 더 적은 노력으로 더 많은 가치를 창출하는 것
 - <strong>코드 소유권은 개인보다는 팀 단위가 좋다.</strong>
 - <strong>브랜치</strong> : 독립 브랜치로 작업하는 기간이 길어질수록 작업 결과를 마스터로 통합하기가 어려워진다. <br/> 자주 통합되어야 리팩터링에 좋다.
 - <strong>테스팅</strong> : 성공/실패 여부를 판단하는 테스트 코드를 작성
 - <strong>레거시 코드 : 레거시 코드는 대체로 복잡하고 테스트가 갖춰지지 않기때문에 있다면 테스트 작성부터한다.</strong>
 
<br/>

## 리팩터링, 아키텍처, 애그니(YAGNI)

 - 이전에는 코딩을 싲가하기 전에 소프트웨어 설계와 아키텍처를 어느정도 또는 거의 완료해야한다고 알려졌지만 리팩터링은 아키텍처를 대폭 변경 가능하다.
 - 탄탄한 테스트가 뒷받침되어야 한다.
 -  리팩터링이 아키텍처에 미치는 실질적인 효과는 요구사항 변화에 자연스럽게 대응하도록 코드 베이스를 잘 설계해준다.
 - 아키텍처를 확정지으려 할 때의 문제는 소프트웨어 요구사항을 사전에 모두 파악해야 한다.

#### 유연성 매커니즘
 - 향후 변경에 유연하게 대처할 수 있는 것
 - 다양한 예상 시나리오에 대응하기 위한 매개변수 추가
 - 당장의 쓰임에 비해 함수가 너무 복잡해짐
 - 오히려 유연성 매커니즘이 변화에 대응하는 능력을 떨어뜨릴 때가 대부분
 
#### 애그니(YAGNI)
 - You aren't going to need it
 - 리팩터링을 활용하여 그저 현재까지 파악한 요구사항만을 해결하는 소프트웨어를 구축

<br/>

## 리팩터링과 소프트웨어 개발 프로세스

 - 익스트림 프로그래밍이란, <strong>지속적 통합(CI), 자가 테스트 코드, 리팩터링</strong> 등의 기법들을 묶은 프로세스다.
 - 자가 테스트 코드와 리팩터링을 묶어서 테스트 주도 개발(TDD)라 칭한다.
 - 리팩터링의 첫 번째 토대는 자가 테스트 코드다.
 - CI를 통해 팀원간의 코드가 계속 통합되어야 높은 효과가 있다.
 - 자가 테스트 코드 + CI + 리팩터링 => 애그니 가능
 - 자가 테스트 코드 + CI + 리팩터링 => 배포 주기를 짧게 가져갈 수 있도록 만들어준다.

<br/>

## 리팩터링과 성능

 - 리팩터링은 이해하기 쉽게 만들기 위해 속도가 느려지는 방향으로 수정되는 경우가 있다.
 - 그와 동시에 성능을 튜닝하기는 더 쉬워진다
 - 튜닝하기 쉽게 만들고 나서 원하는 속도가 나오게끔 튜닝한다.

<br/>

## 빠른 소프트웨어를 작성하는 방법 세 가지
 - 시간 예산 분배(time budgeting)
 - 끊임 없이 관심을 기울이기
 - 코드를 다루기 쉽게 만들기

<br/>

## 리팩터링 최적화
 - 성능 튜닝에 투입할 시간과 성능에 집중할 시간을 벌수있다
 - 리팩터링이 잘되어 있는 프로그램은 성능을 더 세밀하게 분석 가능
 - 리팩터링은 성능 좋은 소프트웨어를 만드는 것에 기여한다.

<br/>


## 리팩터링 자동화 
 - 자동 리팩터링을 지원하는 도구 등장
  인텔리제이 IDEA </br>
  이클립스</br>
  자바로 프로그래밍 할 때는 메서드 이름을 바꾸는 작업을 메뉴에서 원하는 항목을 클릭하는 것만으로 처리 가능</br>
  테스트가 필요 없을 정도로 안정적</br>
 - 현재는 에디터나 독립 도구에서느 리팩터링 기능을 제공할 정도로 흔해짐
 - 언어마다 리팩터링 자동화할 수 있는 범위가 다름
 - 자동 리팩터링을 제대로 구현하려면 구문 트리로 해석해서 다뤄야 함
 - 뛰어난 IDE가 자동 리팩터링도 더 풍부하게 제공
 - 정적 타입 언어라면 훨씬 안전하게 구현할 수 있는 리팩터링 수가 늘어남

#### 언어 서버
 - 구문 트리를 구성해서 텍스트 에디터에 API 형태로 제공하는 소프트웨어
 - 언어 서버는 다양한 텍스트 에디터를 지원
 - 정교한 코드 분석, 리팩터링 기능 제공


<br/><br/><br/>
----------------------------------------------------------------------------------------------------------

## 참고자료
[Refactoring - 리팩터링 원칙](https://greedysiru.tistory.com/801?category=938430).
